# ゲーム制作パイプライン設計書
## Novel-PWA Engine 技術仕様書 v1.2

> **変更履歴**
> - v1.1 → v1.2: dataフォルダのPart別再構成、RESULT概念導入、TSX移行計画追記

---

## 1. プロジェクト全体構成

### 1.1 ルートフォルダ構成（v1.1と同様）

| フォルダ | 役割 |
|---------|------|
| `src/` | メインソースコード |
| `public/` | 静的配信ファイル |
| `00_製作依頼書一覧/` | 制作ドキュメント |
| `AI_Doc/` | AI連携用ドキュメント |
| `dist/` | ビルド出力 |

### 1.2 src/assets/data 新構成（v1.2変更点）

```
src/assets/data/
├── Novel/                    # シナリオ系
│   ├── scenario.json         # メインシナリオ
│   ├── scenarios/            # 分割クエストシナリオ
│   │   └── quest_XXX.json
│   ├── episodes.json         # エピソード・チャプター構造
│   └── events.json           # イベント定義
│
├── Battle/                   # バトル系（将来拡張）
│   ├── skills.json           # スキル定義
│   ├── battle_config.json    # バトルパラメータ
│   └── formations.json       # 陣形・編成
│
├── Collection/               # 素材ライブラリDB
│   ├── characters.json       # プレイアブルキャラ
│   ├── npcs.json             # NPC
│   ├── enemies.json          # 敵
│   ├── items.json            # アイテム
│   ├── backgrounds.json      # 背景・地名
│   ├── gallery.json          # CG・カットイン
│   ├── tags.json             # タグマスタ
│   └── tips.json             # Tips・世界観DB
│
└── Result/                   # 報酬・解放設計（v1.2新規）
    ├── result_sheets.json    # RESULT定義一覧
    └── flags_master.json     # フラグマスタ
```

### 1.3 フォルダ分け判定基準

| 格納先 | 判定基準 |
|--------|---------|
| `Novel/` | シナリオ進行に直接使用するJSON |
| `Battle/` | バトルシステム専用パラメータ |
| `Collection/` | **図鑑・ライブラリで閲覧可能なもの全て** |
| `Result/` | クリア報酬・解放・フラグ設計 |

> **重要**: スキルやアイテムなど、バトルで使用するがCollectionでも閲覧するものは **Collection** に格納。Battle側からは参照のみ。

---

## 2. RESULT設計概念（v1.2新規）

### 2.1 RESULTとは

> 「そのイベント／章をクリアすると、何が変わるのか？」を人間が一目で把握するための設計テーブル。

#### 役割
- ✔ 攻略本の"報酬一覧表"を作る
- ✔ 設計の抜け（報酬が無い、導線が無い）を見つける
- ✔ 後からゲーム実装用の正式スキーマへ昇格させる
- ✔ AIに素材発注・演出指示を出す材料にする

> ⚠ **注意**: まだ「実行データ」ではありません。設計ドキュメントです。

### 2.2 RESULT Sheet スキーマ（Lite v0.1）

```json
{
  "resultId": "result_ep01_ch01",
  "title": "森の探索クリア報酬",
  "trigger": "ep01_ch01_clear",

  "rewards": {
    "items": ["item_potion"],
    "skills": [],
    "characters": [],
    "cg": [],
    "bgm": []
  },

  "unlocks": {
    "events": ["event_020"],
    "locations": ["loc_forest_deep"],
    "features": ["battle_mode"]
  },

  "flags": {
    "forest_cleared": true
  },

  "note": "最初の導線確認用。報酬弱め。"
}
```

### 2.3 RESULT Sheet カラム定義

| カラム | 型 | 説明 |
|--------|-----|------|
| `resultId` | string | `result_{ep}_{ch}` 形式 |
| `title` | string | 表示用タイトル |
| `trigger` | string | 発動条件（イベントID or フラグ名） |
| `rewards.items` | array | 獲得アイテムID |
| `rewards.skills` | array | 獲得スキルID |
| `rewards.characters` | array | 仲間加入キャラID |
| `rewards.cg` | array | 解放CG ID |
| `rewards.bgm` | array | 解放BGM ID |
| `unlocks.events` | array | 解放イベントID |
| `unlocks.locations` | array | 解放ロケーションID |
| `unlocks.features` | array | 解放機能名 |
| `flags` | object | 立つフラグ名: true/false |
| `note` | string | 設計メモ |

### 2.4 この段階で入れないもの（重要）

| 除外項目 | 理由 |
|---------|------|
| プレイ時間 | 実装依存 |
| 数値成長（EXP, HP） | バランス調整は後 |
| バトル統計 | 実装後に追加 |
| ログ履歴 | 実装後に追加 |
| セーブ構造 | 実装後に追加 |
| 分岐履歴 | 実装後に追加 |
| バージョン管理 | 実装後に追加 |

> **設計思考が「実装」に引きずられないよう、報酬設計・導線設計に集中**

---

## 3. Collection ライブラリー（Part責務明確化）

### 3.1 格納対象（再定義）

| JSON | 格納場所 | 理由 |
|------|---------|------|
| `characters.json` | Collection/ | 図鑑で閲覧可能 |
| `enemies.json` | Collection/ | 図鑑で閲覧可能 |
| `items.json` | Collection/ | 図鑑で閲覧可能 |
| `skills.json` | **Battle/** | 図鑑なし（将来追加時はCollection移動） |
| `npcs.json` | Collection/ | 図鑑で閲覧可能 |
| `backgrounds.json` | Collection/ | 地名辞典で閲覧可能 |
| `gallery.json` | Collection/ | CGギャラリーで閲覧可能 |
| `tags.json` | Collection/ | TipsDBで閲覧可能 |
| `tips.json` | Collection/ | TipsDBで閲覧可能 |

### 3.2 参照フロー

```
Battle/skills.json ← 参照 ← Collection/characters.json (スキル保有)
Battle/skills.json ← 参照 ← Collection/enemies.json (敵スキル)
```

---

## 4. 技術移行計画

### 4.1 TSX移行（v1.3予定）

| 項目 | 現状 | 移行後 |
|------|------|--------|
| ファイル拡張子 | `.jsx` | `.tsx` |
| 型定義 | なし | TypeScript interface |
| JSON型 | 暗黙的 | 型定義ファイル作成 |

#### 移行優先順位
1. `useGameStore.js` → `useGameStore.ts`
2. `dataLoader.js` → `dataLoader.ts`
3. 各Screen → 順次移行

### 4.2 タイルウィンドウについて（質問回答）

> **推奨: 現段階では不要**

| 観点 | 判断 |
|------|------|
| ノベルゲーム特性 | 全画面没入が基本 |
| 開発コスト | Split View実装は複雑 |
| ユーザー体験 | モバイル前提なら不要 |
| デバッグ用途 | JsonEditor側パネルで十分 |

**将来追加する場合**:
- 開発者モード限定
- Collection閲覧 + メインゲーム並列表示
- CSS Grid または React Split Pane

---

## 5. ID設計（v1.2追記）

### 5.1 RESULT用ID規則

| 種別 | 形式 | 例 |
|------|------|-----|
| resultId | `result_{ep}_{ch}` | `result_ep01_ch01` |
| trigger | イベントID or フラグ名 | `ep01_ch01_clear` |
| flag名 | `{location/feature}_cleared` | `forest_cleared` |

---

## 6. 付録：フォルダ移動チェックリスト

現行 → v1.2移行時の作業:

- [ ] `src/assets/data/` 配下にサブフォルダ作成
- [ ] `Novel/` に scenario.json, scenarios/, episodes.json, events.json 移動
- [ ] `Collection/` に characters, enemies, items, npcs, backgrounds, gallery, tags, tips 移動
- [ ] `Battle/` 作成（空でOK、将来用）
- [ ] `Result/` 作成、result_sheets.json 新規作成
- [ ] `dataLoader.js` のimportパス更新
- [ ] 各コンポーネントのimportパス更新

---

**Document Version**: 1.2  
**Last Updated**: 2026-01-16  
**Author**: AI Assistant
