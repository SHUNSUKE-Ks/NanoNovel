# シナリオ作成マニュアル

> 本ドキュメントは、Novel PWA のシナリオJSON作成・編集時のルールと仕様を定義します。

---

## 1. storyID 命名規則

### フォーマット
```
[TYPE]_EP_CH_TXT
```

| 区分 | 桁数 | 説明 |
|-----|------|------|
| TYPE | 1文字 | コンテンツ種別 |
| EP | 2桁 | エピソード番号 |
| CH | 2桁 | チャプター番号 |
| TXT | 2〜4桁 | テキスト連番 |

### TYPE 接頭詞

| 接頭詞 | 意味 | 用途 |
|--------|------|------|
| `M` | Main | メインストーリー |
| `Q` | Quest | クエスト |
| `S` | Side | サイドイベント（将来用） |

### 例

```
M_01_01_01  → メイン Episode 1, Chapter 1, Text 1
M_01_02_15  → メイン Episode 1, Chapter 2, Text 15
Q_03_01_01  → Quest 03, Chapter 1, Text 1
Q_03_01_10  → Quest 03, Chapter 1, Text 10
```

---

## 2. JSON スキーマ定義

### ファイル構造

```json
{
    "meta": {
        "title": "シナリオタイトル",
        "type": "short_novel | quest",
        "version": "1.0",
        "storyIdFormat": "[TYPE]_EP_CH_TXT"
    },
    "scenario": [
        { /* ノード配列 */ }
    ]
}
```

### ノード共通スキーマ

```typescript
interface ScenarioNode {
    storyID: string;          // 必須: 一意のID (例: "M_01_01_01")
    scene: number;            // 必須: シーン番号
    type?: "SCENE_START";     // 任意: シーン開始ノード
    speaker?: string;         // 任意: 話者名
    text?: string;            // 任意: 本文テキスト
    event?: EventObject;      // 任意: イベント定義
    backgroundImage?: string; // 任意: 背景画像パス
    characterImage?: string;  // 任意: キャラ画像パス
    bgm?: string;             // 任意: BGMキー
    questTitle?: string;      // 任意: タイトルコール用テキスト
    sceneTags?: string[];     // 任意: シーンタグ配列
    tags?: string[];          // 任意: キャラタグ配列
    flags?: object;           // 任意: フラグ設定
    note?: string;            // 任意: 開発用メモ
}
```

### イベントオブジェクト スキーマ

```typescript
interface EventObject {
    type: "SCENE_START" | "BATTLE_START" | "CHOICE" | "TAP_NEXT" | "END";
    payload?: EventPayload;
}

// CHOICE イベント
interface ChoicePayload {
    choices: Array<{
        label: string;
        nextStoryID: string;
    }>;
}

// TAP_NEXT イベント
interface TapNextPayload {
    nextStoryID: string;
}

// END イベント
interface EndPayload {
    goto?: "RESULT" | "COLLECTION";
}
```

---

## 3. ノードタイプ一覧

### 3.1 SCENE_START（シーン開始）

```json
{
    "storyID": "Q_03_01_01",
    "scene": 1,
    "type": "SCENE_START",
    "questTitle": "森の遺跡の調査",
    "sceneTags": ["bg_forest_ruins"],
    "backgroundImage": "bg/forest_ruins.png",
    "bgm": "mori01"
}
```

| プロパティ | 必須 | 説明 |
|-----------|------|------|
| `type` | ✅ | `"SCENE_START"` 固定 |
| `questTitle` | ○ | タイトルコールに表示 |
| `backgroundImage` | ○ | 背景画像パス |
| `bgm` | ○ | BGMキー |

---

### 3.2 通常テキストノード

```json
{
    "storyID": "Q_03_01_02",
    "scene": 1,
    "speaker": "ナレーション",
    "text": "依頼を受けたあなたは、森の奥深くにある遺跡へとやってきた。"
}
```

---

### 3.3 BATTLE_START（バトル開始）

```json
{
    "storyID": "Q_03_01_05",
    "scene": 1,
    "event": {
        "type": "BATTLE_START"
    },
    "speaker": "システム",
    "text": "バトル開始！シャドウウルフが襲い掛かってきた！",
    "characterImage": "Monster_01.png"
}
```

---

### 3.4 CHOICE（選択肢）

```json
{
    "storyID": "M_01_02_03",
    "scene": 2,
    "event": {
        "type": "CHOICE",
        "payload": {
            "choices": [
                { "label": "はい", "nextStoryID": "M_01_02_04" },
                { "label": "いいえ", "nextStoryID": "M_01_02_10" }
            ]
        }
    },
    "speaker": "NPC",
    "text": "この依頼を受けますか？"
}
```

---

### 3.5 TAP_NEXT（強制ジャンプ）

```json
{
    "storyID": "M_01_01_04",
    "scene": 1,
    "event": {
        "type": "TAP_NEXT",
        "payload": {
            "nextStoryID": "M_01_02_01"
        }
    }
}
```

---

### 3.6 END（終了）

```json
{
    "storyID": "Q_03_01_10",
    "scene": 1,
    "event": {
        "type": "END",
        "payload": {
            "goto": "COLLECTION"
        }
    }
}
```

| `goto` 値 | 遷移先 |
|-----------|--------|
| `"COLLECTION"` | クエスト一覧画面 |
| `"RESULT"` / 省略 | リザルト画面 |

---

## 4. ファイル配置ルール

```
src/assets/data/scenarios/
  ├── scenario.json      # メインストーリー (M_xx_xx_xx)
  ├── quest_001.json     # クエスト001 (Q_01_xx_xx)
  ├── quest_002.json     # クエスト002 (Q_02_xx_xx)
  └── quest_003.json     # クエスト003 (Q_03_xx_xx)
```

---

## 5. クエストシナリオ テンプレート

```json
[
    {
        "storyID": "Q_03_01_01",
        "scene": 1,
        "type": "SCENE_START",
        "questTitle": "クエストタイトル",
        "backgroundImage": "bg/xxxx.png",
        "bgm": "bgm_key"
    },
    {
        "storyID": "Q_03_01_02",
        "scene": 1,
        "speaker": "ナレーション",
        "text": "導入テキスト..."
    },
    {
        "storyID": "Q_03_01_03",
        "scene": 1,
        "event": { "type": "BATTLE_START" },
        "speaker": "システム",
        "text": "バトル開始！"
    },
    {
        "storyID": "Q_03_01_04",
        "scene": 1,
        "speaker": "システム",
        "text": "ミッション達成！報酬を獲得した。"
    },
    {
        "storyID": "Q_03_01_05",
        "scene": 1,
        "event": {
            "type": "END",
            "payload": { "goto": "COLLECTION" }
        }
    }
]
```

---

## 6. 注意事項

- `storyID` は **ファイル内で一意** である必要があります
- `nextStoryID` は **同一ファイル内に存在** するIDを指定
- BGMキーは `src/assets/sound/bgm/00_bgmlist01.json` と一致させる
- 画像パスは `src/assets/` からの相対パス
- 分岐がある場合、TXT番号を10単位で空けておくと挿入しやすい
