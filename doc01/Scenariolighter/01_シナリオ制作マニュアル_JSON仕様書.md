# シナリオ制作マニュアル (JSON仕様書)

## 1. 概要

本ゲームのシナリオデータは JSON 形式で管理されます。
ライター様には、このフォーマットに従ってテキストと演出データを記述していただきます。

## 2. 基礎構造 (Story Object)

シナリオファイルは、以下の `Story Object` の配列（リスト）です。

```json
[
  {
    "storyID": "01_01_01",
    "speaker": "主人公",
    "text": "こんにちは、世界。",
    "tags": ["bg_forest_morning_1280x720", "chara_hero_smile_1024x1024"],
    "event": { "type": "NONE", "payload": {} },
    "flags": {},
    "effects": [],
    "tips": [],
    "note": "冒頭の挨拶"
  },
  ...
]
```

## 3. 各フィールド詳細

### 3.1 storyID (必須)

シーンを特定する一意のIDです。
**フォーマット**: `EP_CH_TXT` (エピソード_チャプター_連番)

- 例: `01_01_01` (第1章 第1話 1行目)
- 例: `01_01_02`
- **ルール**: 他の行と絶対に重複してはいけません。

### 3.2 speaker (必須)

話者の名前です。

- **空文字 `""`**: ナレーション（地の文）
- **文字列**: キャラクター名（例: `"主人公"`, `"謎の少女"`）

### 3.3 text (必須)

表示する文章です。

- 改行は `\n` を使用できますが、基本的にはシステム側で自動折り返しされます。
- 長すぎる場合は新たな行（新しいstoryID）に分割してください。

### 3.4 tags (必須/空配列可)

このシーンで表示する画像（背景・立ち絵）や再生するBGMを指定する「タグ」のリストです。

- **ルール**:
    - **パス（ファイル名）を直接書かないでください**。
    - 必ず `tags_master.csv` (別途配布) に定義されたタグを使用してください。
    - 命名規則: `{category}_{name}_{size}` (例: `bg_forest_morning_1280x720`)

### 3.5 event (必須)

特殊な動作（選択肢、アイテム入手など）を定義します。
通常は `NONE` です。

#### Type一覧

| Type | 説明 | payloadの構造 |
|------|------|---------------|
| `NONE` | 何もしない | `{}` |
| `CHOICE` | 選択肢を表示 | `{ "choices": [ { "label": "選択文言", "nextStoryID": "遷移先ID" }, ... ] }` |
| `JUMP` | 特定IDへ強制移動 | `{ "nextStoryID": "遷移先ID" }` |
| `ITEM` | アイテム入手 | `{ "itemID": "アイテムID", "count": 1 }` |
| `BATTLE` | 戦闘開始 | `{ "enemyIDs": ["敵ID"], "reward": {...} }` |

### 3.6 flags (任意)

このシーン通過時に立てるフラグです。

- 例: `{ "met_heroine": true, "loyalty": 5 }`
- 変数名（キー）は英小文字とアンダースコア推奨です。

### 3.7 effects (任意)

画面効果を指定します。

- 例: `["fade_in"]`, `["shake"]`, `["flash"]`

### 3.8 tips (任意)

用語集（Tips）に追加するIDを指定します。

- 例: `["world_history", "magic_theory"]`

### 3.9 note (任意)

メモ欄です。ゲーム画面には表示されません。
演出意図や管理者への申し送り事項などを記載してください。

## 4. 執筆ルール・注意点

### ✅ 禁止事項

1.  **JSON構文エラー**:
    - 最後の要素の後ろにカンマ `,` をつけないでください。
    - 文字列は必ずダブルクォート `"` で囲んでください。
2.  **全角文字の仕様**:
    - キー名（`storyID`, `text` 等）は **半角英数** です。
    - `text` や `speaker` の中身は日本語OKです。
3.  **存在しないタグ・IDの指定**:
    - `nextStoryID` で指定したIDがファイル内に存在しない場合、ゲームが停止します。

### ✅ 推奨ワークフロー

1.  エピソードごとにファイルを分ける (`ep01.json`, `ep02.json`...)
2.  こまめにLintツールで構文チェックを行う
3.  `storyID` は10刻みなどで余裕を持たせると、後で挿入しやすくなります（例: 01_01_10, 01_01_20... ※システムが許容する場合）

---

## 5. サンプル (CHOICEイベント)

```json
{
    "storyID": "01_01_06",
    "speaker": "主人公",
    "text": "分かれ道だ。どっちに行こう？",
    "tags": ["bg_crossroad_1280x720"],
    "event": {
        "type": "CHOICE",
        "payload": {
            "choices": [
                {
                    "label": "右の道へ",
                    "nextStoryID": "01_01_07"
                },
                {
                    "label": "左の道へ",
                    "nextStoryID": "01_01_20"
                }
            ]
        }
    },
    "flags": {},
    "effects": [],
    "tips": [],
    "note": "運命の分岐点"
}
```

以上
